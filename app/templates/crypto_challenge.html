{% extends "base.html" %}

{% block title %}–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>üîê –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: {{ title }}</h2>
            <div class="alert alert-info">
                <strong>–ó–∞–¥–∞—á–∞:</strong> –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏.
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üìÑ –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
                        <textarea class="form-control" rows="8" readonly style="font-family: monospace; font-size: 14px;">{{ encrypted_content }}</textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üîç –ê–Ω–∞–ª–∏–∑ —à–∏—Ñ—Ä–∞</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('analyze_cipher') }}">
                        <input type="hidden" name="research_id" value="{{ research_id }}">
                        
                        <div class="form-group">
                            <label for="shift">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–≤–∏–≥ (0-25):</label>
                            <input type="number" class="form-control" id="shift" name="shift" min="0" max="25" 
                                   value="{% if attempted_shift %}{{ attempted_shift }}{% else %}0{% endif %}" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                    </form>

                    {% if attempted_shift is defined %}
                    <div class="mt-4">
                        <h6>–†–µ–∑—É–ª—å—Ç–∞—Ç —Å —Å–¥–≤–∏–≥–æ–º {{ attempted_shift }}:</h6>
                        <div class="alert alert-secondary">
                            <pre style="white-space: pre-wrap; font-size: 12px;">{{ attempted_result }}</pre>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li>üî§ <strong>–ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ—Ç:</strong> –í –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –±—É–∫–≤–∞ 'E' –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ</li>
                        <li>üìä <strong>–®–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è:</strong> –ö–∞–∂–¥–∞—è –±—É–∫–≤–∞ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h6>üìà –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ—Ç –±—É–∫–≤</h6>
                </div>
                <div class="card-body">
                    <div id="frequency-analysis">
                        <script>
                            function analyzeFrequency() {
                                const text = `{{ encrypted_content }}`.toUpperCase();
                                const freq = {};
                                let totalLetters = 0;
                                
                                for (let char of text) {
                                    if (char.match(/[A-Z]/)) {
                                        freq[char] = (freq[char] || 0) + 1;
                                        totalLetters++;
                                    }
                                }
                                
                                const sorted = Object.entries(freq)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 5);
                                
                                let html = '<p><strong>–¢–æ–ø-5 –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã—Ö –±—É–∫–≤:</strong></p><ul>';
                                for (let [letter, count] of sorted) {
                                    const percentage = ((count / totalLetters) * 100).toFixed(1);
                                    html += `<li><code>${letter}</code>: ${count} —Ä–∞–∑ (${percentage}%)</li>`;
                                }
                                html += '</ul>';
                                html += '<p><em>–í –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –±—É–∫–≤–∞ - E (~12.7%)</em></p>';
                                
                                document.getElementById('frequency-analysis').innerHTML = html;
                            }
                            
                            analyzeFrequency();
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-12">
            <a href="{{ url_for('research') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º</a>
        </div>
    </div>
</div>
{% endblock %} 