{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –°–µ–∫—Ä–µ—Ç–Ω–∞—è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è{% endblock %}

{% block content %}
<div class="lab-container">
    <div class="row">
        <div class="col-12">
            <h1><i class="fas fa-tachometer-alt"></i> –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <p class="lead">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}! –í–∞—à–∞ —Ä–æ–ª—å: <span class="badge bg-primary">{{ user.role }}</span></p>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-microscope fa-3x text-success mb-3"></i>
                    <h5 class="card-title">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</h5>
                    <p class="card-text">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
                    <a href="{{ url_for('research') }}" class="btn btn-success">
                        <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                    </a>
                </div>
            </div>
        </div>

        {% if user.role == 'admin' %}
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-cog fa-3x text-warning mb-3"></i>
                    <h5 class="card-title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>
                    <p class="card-text">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p>
                    <a href="{{ url_for('admin') }}" class="btn btn-warning">
                        <i class="fas fa-tools"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-user fa-3x text-info mb-3"></i>
                    <h5 class="card-title">–ü—Ä–æ—Ñ–∏–ª—å</h5>
                    <p class="card-text">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ</p>
                    <button class="btn btn-info" onclick="loadUserInfo()">
                        <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="user-info" class="mt-4" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-user-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> {{ user.user_id }}</p>
                        <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> {{ user.username }}</p>
                        <p><strong>–†–æ–ª—å:</strong> {{ user.role }}</p>
                        <p><strong>–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏:</strong> <span id="token-exp"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="vulnerability-hint mt-4">
        <h6><i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</h6>
        <div class="row">
            <div class="col-md-6">
                <p><strong>üîç –ó–∞–¥–∞—á–∞ 2 - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è:</strong></p>
                <ul class="small">
                    <li>–ö–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ —Ç–∞–∫–∏–º–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏...</li>
                </ul>
            </div>
            <div class="col-md-6">
                <p><strong>üîë –ó–∞–¥–∞—á–∞ 3 - –≠—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π:</strong></p>
                <ul class="small">
                    <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</li>
                </ul>
            </div>
        </div>
    </div>

   
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadUserInfo() {
    const userInfoDiv = document.getElementById('user-info');
    
    if (userInfoDiv.style.display === 'none') {
        try {
            const response = await fetch('/api/user_info');
            const data = await response.json();
            
            if (response.ok) {
                
                const tokenParts = data.jwt_token.split('.');
                const payload = JSON.parse(atob(tokenParts[1]));
                const expDate = new Date(payload.exp * 1000);
                document.getElementById('token-exp').textContent = expDate.toLocaleString();
                
                userInfoDiv.style.display = 'block';
                
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: ' + data.error);
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
        }
    } else {
        userInfoDiv.style.display = 'none';
    }
}
</script>
{% endblock %} 